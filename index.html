<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Shift Scheduling System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .shift-night { background: linear-gradient(135deg, #1e3a8a, #3730a3); }
        .shift-morning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .shift-late { background: linear-gradient(135deg, #059669, #047857); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-day {
            background: white;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .calendar-day:hover {
            background: #f3f4f6;
        }
        
        .calendar-day.disabled {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .calendar-day.selected {
            background: #3b82f6;
            color: white;
        }
        
        .calendar-day.in-range {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .calendar-day.start-range, .calendar-day.end-range {
            background: #3b82f6;
            color: white;
        }
        
        .employee-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .employee-card.assigned {
            background: #f0f9ff;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                Multi-Shift Scheduling System
            </h1>
            <p class="text-gray-600">Manage your team shifts with intelligent scheduling</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Component 1 - Shift Assignment -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Shift Assignment
                </h2>

                <!-- Date Range Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Select Date Range</label>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <!-- Calendar Header -->
                        <div class="flex items-center justify-between mb-4">
                            <button id="prevMonth" class="p-2 hover:bg-white rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>
                            <h3 id="currentMonth" class="text-lg font-semibold"></h3>
                            <button id="nextMonth" class="p-2 hover:bg-white rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Day Headers -->
                        <div class="calendar-grid mb-1">
                            <div class="calendar-day disabled font-semibold text-xs">Sun</div>
                            <div class="calendar-day disabled font-semibold text-xs">Mon</div>
                            <div class="calendar-day disabled font-semibold text-xs">Tue</div>
                            <div class="calendar-day disabled font-semibold text-xs">Wed</div>
                            <div class="calendar-day disabled font-semibold text-xs">Thu</div>
                            <div class="calendar-day disabled font-semibold text-xs">Fri</div>
                            <div class="calendar-day disabled font-semibold text-xs">Sat</div>
                        </div>
                        
                        <!-- Calendar Days -->
                        <div id="calendarDays" class="calendar-grid"></div>
                        
                        <!-- Selected Range Display -->
                        <div id="selectedRange" class="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800 hidden">
                            <strong>Selected:</strong> <span id="rangeText"></span>
                        </div>
                    </div>
                </div>

                <!-- Shift Type Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Shift Type</label>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="shift-type-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-shift="night">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 shift-night rounded-lg flex items-center justify-center text-white text-xl">üåô</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Night Shift</h3>
                                    <p class="text-sm text-gray-600">22:30 - 06:30</p>
                                </div>
                            </div>
                        </div>
                        <div class="shift-type-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-orange-500 transition-all" data-shift="morning">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 shift-morning rounded-lg flex items-center justify-center text-white text-xl">‚òÄÔ∏è</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Morning Shift</h3>
                                    <p class="text-sm text-gray-600">06:30 - 14:30</p>
                                </div>
                            </div>
                        </div>
                        <div class="shift-type-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition-all" data-shift="late">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 shift-late rounded-lg flex items-center justify-center text-white text-xl">üåÜ</div>
                                <div>
                                    <h3 class="font-semibold text-gray-800">Late Shift</h3>
                                    <p class="text-sm text-gray-600">14:30 - 22:30</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Available Employees -->
                <div id="availableEmployees" class="hidden animate-fade-in">
                    <div class="flex items-center justify-between mb-4">
                        <label class="text-sm font-medium text-gray-700">Available Employees</label>
                        <button id="assignAllBtn" class="text-sm bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                            Assign All
                        </button>
                    </div>
                    <div id="employeesList" class="grid grid-cols-1 gap-3 max-h-60 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Component 2 - Schedule Overview -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Schedule Overview
                </h2>

                <!-- Shift Tabs -->
                <div class="flex bg-gray-100 rounded-lg p-1 mb-6">
                    <button class="shift-tab flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all active" data-shift="night">
                        üåô Night Shift
                    </button>
                    <button class="shift-tab flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" data-shift="morning">
                        ‚òÄÔ∏è Morning Shift
                    </button>
                    <button class="shift-tab flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" data-shift="late">
                        üåÜ Late Shift
                    </button>
                </div>

                <!-- Schedule Content -->
                <div id="scheduleContent" class="space-y-4 max-h-96 overflow-y-auto"></div>

                <!-- Summary Stats -->
                <div class="mt-6 grid grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div id="totalEmployees" class="text-2xl font-bold text-blue-600">0</div>
                        <div class="text-sm text-blue-800">Total Employees</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div id="totalAssignments" class="text-2xl font-bold text-green-600">0</div>
                        <div class="text-sm text-green-800">Assignments</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div id="avgShifts" class="text-2xl font-bold text-purple-600">0</div>
                        <div class="text-sm text-purple-800">Avg/Employee</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="mt-8 text-center">
            <button onclick="resetAllData()" class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-colors font-medium">
                üîÑ Reset All Data
            </button>
        </div>
    </div>

    <script>
        // Application State
        let scheduleData = {
            employees: [],
            shifts: {
                night: { name: 'Night Shift', time: '22:30-06:30', icon: 'üåô', assignments: {} },
                morning: { name: 'Morning Shift', time: '06:30-14:30', icon: '‚òÄÔ∏è', assignments: {} },
                late: { name: 'Late Shift', time: '14:30-22:30', icon: 'üåÜ', assignments: {} }
            }
        };

        let currentDate = new Date(2025, 5, 1); // June 2025
        let selectedStartDate = null;
        let selectedEndDate = null;
        let selectedShift = null;
        let activeTab = 'night';

        // Working days in June 2025
        const workingDays = [
            '2025-06-02', '2025-06-03', '2025-06-04', '2025-06-05', '2025-06-06',
            '2025-06-09', '2025-06-10', '2025-06-11', '2025-06-12', '2025-06-13',
            '2025-06-16', '2025-06-17', '2025-06-18', '2025-06-19', '2025-06-20',
            '2025-06-23', '2025-06-24'
        ];

        // Initialize default employees
        function initializeEmployees() {
            const defaultEmployees = [
                { name: 'Abhiram R', group: 'A' },
                { name: 'Devaganga K', group: 'A' },
                { name: 'Kavya M', group: 'A' },
                { name: 'Adarsh J', group: 'A' },
                { name: 'Divya S', group: 'A' },
                { name: 'Aleena J', group: 'A' },
                { name: 'Emily E', group: 'B' },
                { name: 'Sanjay G', group: 'B' },
                { name: 'Jefferson A', group: 'B' },
                { name: 'Jerome B', group: 'B' },
                { name: 'Aswathi P', group: 'B' },
                { name: 'Joseph J', group: 'B' },
                { name: 'Tilmeezur R', group: 'C' },
                { name: 'Justyna S', group: 'C' },
                { name: 'Vishnu B', group: 'C' },
                { name: 'Bony R', group: 'C' },
                { name: 'Kattackakathu N', group: 'C' }
            ];

            scheduleData.employees = defaultEmployees.map(emp => ({
                ...emp,
                totalShifts: 0,
                shiftBreakdown: { night: 0, morning: 0, late: 0 }
            }));
        }

        // Calendar Functions
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function isWorkingDay(dateStr) {
            return workingDays.includes(dateStr);
        }

        function isDateInRange(date, start, end) {
            if (!start || !end) return false;
            return date >= start && date <= end;
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(currentDate);

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dateStr = formatDate(date);
                const isCurrentMonth = date.getMonth() === month;
                const isWorking = isWorkingDay(dateStr);
                const isSelected = (selectedStartDate && date.getTime() === selectedStartDate.getTime()) ||
                                  (selectedEndDate && date.getTime() === selectedEndDate.getTime());
                const isInRange = selectedStartDate && selectedEndDate && 
                                  isDateInRange(date, selectedStartDate, selectedEndDate);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                dayElement.dataset.date = dateStr;

                if (!isCurrentMonth || !isWorking) {
                    dayElement.classList.add('disabled');
                } else {
                    if (isSelected) {
                        dayElement.classList.add(selectedStartDate && date.getTime() === selectedStartDate.getTime() ? 'start-range' : 'end-range');
                    } else if (isInRange) {
                        dayElement.classList.add('in-range');
                    }

                    dayElement.addEventListener('click', () => selectDate(date));
                }

                calendarDays.appendChild(dayElement);
            }
        }

        function selectDate(date) {
            if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                // Start new selection
                selectedStartDate = new Date(date);
                selectedEndDate = null;
            } else {
                // Complete range selection
                if (date < selectedStartDate) {
                    selectedEndDate = selectedStartDate;
                    selectedStartDate = new Date(date);
                } else {
                    selectedEndDate = new Date(date);
                }
            }

            updateSelectedRange();
            renderCalendar();
            updateAvailableEmployees();
            updateScheduleOverview();
            updateSummaryStats();

            document.querySelectorAll('.shift-type-card').forEach(card => {
                    card.classList.remove('border-blue-500', 'border-orange-500', 'border-green-500', 'bg-blue-50', 'bg-orange-50', 'bg-green-50');
                    card.classList.add('border-gray-200');
                });
            document.getElementById('availableEmployees').classList.add('hidden');
            alert('All data has been reset successfully!');
        }
        function setupCalendarNavigation() {
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }
        function updateSelectedRange() {
            const rangeDiv = document.getElementById('selectedRange');
            const rangeText = document.getElementById('rangeText');

            if (selectedStartDate) {
                if (selectedEndDate) {
                    rangeText.textContent = `${selectedStartDate.toLocaleDateString()} - ${selectedEndDate.toLocaleDateString()}`;
                } else {
                    rangeText.textContent = selectedStartDate.toLocaleDateString();
                }
                rangeDiv.classList.remove('hidden');
            } else {
                rangeDiv.classList.add('hidden');
            }
        }

        // Initialize Application
        function initializeApp() {
            // Load existing data or initialize with defaults
            if (!loadData()) {
                initializeEmployees();
            }

        // Shift Selection
        function setupShiftSelection() {
            document.querySelectorAll('.shift-type-card').forEach(card => {
                card.addEventListener('click', () => {
                    // Remove active state from all cards
                    document.querySelectorAll('.shift-type-card').forEach(c => {
                        c.classList.remove('border-blue-500', 'border-orange-500', 'border-green-500', 'bg-blue-50', 'bg-orange-50', 'bg-green-50');
                        c.classList.add('border-gray-200');
                    });

                    // Add active state to selected card
                    const shift = card.dataset.shift;
                    selectedShift = shift;
                    
                    if (shift === 'night') {
                        card.classList.add('border-blue-500', 'bg-blue-50');
                    } else if (shift === 'morning') {
                        card.classList.add('border-orange-500', 'bg-orange-50');
                    } else if (shift === 'late') {
                        card.classList.add('border-green-500', 'bg-green-50');
                    }

                    updateAvailableEmployees();
                });
            });
        }

        // Employee Management
        function updateAvailableEmployees() {
            const container = document.getElementById('availableEmployees');
            const employeesList = document.getElementById('employeesList');

            if (!selectedStartDate || !selectedShift) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            employeesList.innerHTML = '';

            const dateRange = getDateRange(selectedStartDate, selectedEndDate || selectedStartDate);
            const availableEmployees = getAvailableEmployees(dateRange, selectedShift);

            availableEmployees.forEach(emp => {
                const empDiv = document.createElement('div');
                empDiv.className = 'employee-card p-3 border-2 border-gray-200 rounded-lg flex items-center justify-between';
                empDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold">
                            ${emp.name.charAt(0)}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${emp.name}</div>
                            <div class="text-sm text-gray-600">Group ${emp.group} ‚Ä¢ ${emp.totalShifts} shifts</div>
                        </div>
                    </div>
                    <button class="assign-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm" data-employee="${emp.name}">
                        Assign
                    </button>
                `;

                empDiv.querySelector('.assign-btn').addEventListener('click', () => {
                    assignEmployeeToShift(emp.name, dateRange, selectedShift);
                });

                employeesList.appendChild(empDiv);
            });

            // Assign All button
            document.getElementById('assignAllBtn').onclick = () => {
                availableEmployees.forEach(emp => {
                    assignEmployeeToShift(emp.name, dateRange, selectedShift);
                });
            };
        }

        function getDateRange(start, end) {
            const dates = [];
            const current = new Date(start);
            
            while (current <= end) {
                const dateStr = formatDate(current);
                if (isWorkingDay(dateStr)) {
                    dates.push(dateStr);
                }
                current.setDate(current.getDate() + 1);
            }
            
            return dates;
        }

        function getAvailableEmployees(dateRange, shiftType) {
            return scheduleData.employees.filter(emp => {
                return !dateRange.some(date => {
                    const assignments = scheduleData.shifts[shiftType].assignments[date] || [];
                    return assignments.includes(emp.name);
                });
            }).sort((a, b) => a.totalShifts - b.totalShifts);
        }

        function assignEmployeeToShift(employeeName, dateRange, shiftType) {
            dateRange.forEach(date => {
                if (!scheduleData.shifts[shiftType].assignments[date]) {
                    scheduleData.shifts[shiftType].assignments[date] = [];
                }
                
                if (!scheduleData.shifts[shiftType].assignments[date].includes(employeeName)) {
                    scheduleData.shifts[shiftType].assignments[date].push(employeeName);
                    
                    // Update employee stats
                    const employee = scheduleData.employees.find(emp => emp.name === employeeName);
                    if (employee) {
                        employee.totalShifts++;
                        employee.shiftBreakdown[shiftType]++;
                    }
                }
            });

            saveData();
            updateAvailableEmployees();
            updateScheduleOverview();
            updateSummaryStats();
        }

        // Schedule Overview
        function setupScheduleTabs() {
            document.querySelectorAll('.shift-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.shift-tab').forEach(t => {
                        t.classList.remove('active', 'bg-white', 'shadow-sm');
                    });
                    
                    tab.classList.add('active', 'bg-white', 'shadow-sm');
                    activeTab = tab.dataset.shift;
                    updateScheduleOverview();
                });
            });
        }

        function updateScheduleOverview() {
            const container = document.getElementById('scheduleContent');
            const assignments = scheduleData.shifts[activeTab].assignments;
            
            container.innerHTML = '';

            if (Object.keys(assignments).length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">${scheduleData.shifts[activeTab].icon}</div>
                        <p>No assignments for ${scheduleData.shifts[activeTab].name}</p>
                    </div>
                `;
                return;
            }

            Object.keys(assignments).sort().forEach(date => {
                const employeeList = assignments[date];
                if (employeeList.length === 0) return;

                const dateDiv = document.createElement('div');
                dateDiv.className = 'bg-gray-50 rounded-lg p-4';
                dateDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-800">${new Date(date).toLocaleDateString()}</h3>
                        <span class="text-sm text-gray-600">${employeeList.length} assigned</span>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        ${employeeList.map(name => `
                            <span class="bg-white px-3 py-1 rounded-full text-sm flex items-center gap-2">
                                ${name}
                                <button onclick="removeAssignment('${date}', '${activeTab}', '${name}')" 
                                        class="text-red-500 hover:text-red-700 text-xs">
                                    √ó
                                </button>
                            </span>
                        `).join('')}
                    </div>
                `;
                container.appendChild(dateDiv);
            });
        }

        function removeAssignment(date, shiftType, employeeName) {
            const assignments = scheduleData.shifts[shiftType].assignments[date];
            const index = assignments.indexOf(employeeName);
            
            if (index > -1) {
                assignments.splice(index, 1);
                
                // Update employee stats
                const employee = scheduleData.employees.find(emp => emp.name === employeeName);
                if (employee) {
                    employee.totalShifts = Math.max(0, employee.totalShifts - 1);
                    employee.shiftBreakdown[shiftType] = Math.max(0, employee.shiftBreakdown[shiftType] - 1);
                }
                
                saveData();
                updateScheduleOverview();
                updateAvailableEmployees();
                updateSummaryStats();
            }
        }

        // Summary Statistics
        function updateSummaryStats() {
            const totalEmployees = scheduleData.employees.length;
            const totalAssignments = scheduleData.employees.reduce((sum, emp) => sum + emp.totalShifts, 0);
            const avgShifts = totalEmployees > 0 ? (totalAssignments / totalEmployees).toFixed(1) : 0;

            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('totalAssignments').textContent = totalAssignments;
            document.getElementById('avgShifts').textContent = avgShifts;
        }

        // Data Persistence
        function saveData() {
            const dataToSave = JSON.stringify(scheduleData);
            const compressedData = btoa(dataToSave);
            document.cookie = `scheduleData=${compressedData}; expires=${new Date(Date.now() + 30*24*60*60*1000).toUTCString()}; path=/`;
        }

        function loadData() {
            const cookies = document.cookie.split(';').map(c => c.trim());
            const dataCookie = cookies.find(c => c.startsWith('scheduleData='));
            
            if (dataCookie) {
                try {
                    const compressedData = dataCookie.split('=')[1];
                    const decompressedData = atob(compressedData);
                    scheduleData = JSON.parse(decompressedData);
                    return true;
                } catch (e) {
                    console.warn('Failed to load saved data:', e);
                }
            }
            return false;
        }

        function resetAllData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                document.cookie = 'scheduleData=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                initializeEmployees();
                scheduleData.shifts.night.assignments = {};
                scheduleData.shifts.morning.assignments = {};
                scheduleData.shifts.late.assignments = {};
                
                selectedStartDate = null;
                selectedEndDate = null;
                selectedShift = null;
                
                renderCalendar();
                updateSelectedRange();
                updateAvailableEmployees

            updateAvailableEmployees();
                updateScheduleOverview();
                updateSummaryStats();
                
                // Reset UI state
                document.querySelectorAll('.shift-type-card').forEach(card => {
                    card.classList.remove('border-blue-500', 'border-orange-500', 'border-green-500', 'bg-blue-50', 'bg-orange-50', 'bg-green-50');
                    card.classList.add('border-gray-200');
                });
                
                document.getElementById('availableEmployees').classList.add('hidden');
                
                alert('All data has been reset successfully!');
            }
        }

        // Calendar Navigation
        function setupCalendarNavigation() {
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }

        // Initialize Application
        function initializeApp() {
            // Load existing data or initialize with defaults
            if (!loadData()) {
                initializeEmployees();
            }

            // Setup event listeners
            setupCalendarNavigation();
            setupShiftSelection();
            setupScheduleTabs();

            // Initial render
            renderCalendar();
            updateScheduleOverview();
            updateSummaryStats();

            // Set initial active tab
            document.querySelector('.shift-tab.active').classList.add('bg-white', 'shadow-sm');
        }

        // Export/Import Functions
        function exportData() {
            const dataStr = JSON.stringify(scheduleData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `schedule-data-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (importedData.employees && importedData.shifts) {
                        scheduleData = importedData;
                        saveData();
                        
                        // Refresh UI
                        renderCalendar();
                        updateScheduleOverview();
                        updateSummaryStats();
                        updateAvailableEmployees();
                        
                        alert('Data imported successfully!');
                    } else {
                        throw new Error('Invalid data format');
                    }
                } catch (error) {
                    alert('Error importing data: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Utility Functions
        function generateScheduleReport() {
            let report = "SHIFT SCHEDULE REPORT\n";
            report += "===================\n\n";
            
            ['night', 'morning', 'late'].forEach(shiftType => {
                const shift = scheduleData.shifts[shiftType];
                report += `${shift.name} (${shift.time})\n`;
                report += "-".repeat(shift.name.length + shift.time.length + 3) + "\n";
                
                const assignments = shift.assignments;
                if (Object.keys(assignments).length === 0) {
                    report += "No assignments\n\n";
                } else {
                    Object.keys(assignments).sort().forEach(date => {
                        if (assignments[date].length > 0) {
                            report += `${new Date(date).toLocaleDateString()}: ${assignments[date].join(', ')}\n`;
                        }
                    });
                    report += "\n";
                }
            });
            
            report += "EMPLOYEE SUMMARY\n";
            report += "===============\n";
            scheduleData.employees.forEach(emp => {
                report += `${emp.name} (Group ${emp.group}): ${emp.totalShifts} total shifts\n`;
                report += `  Night: ${emp.shiftBreakdown.night}, Morning: ${emp.shiftBreakdown.morning}, Late: ${emp.shiftBreakdown.late}\n`;
            });
            
            // Create and download report
            const reportBlob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(reportBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `schedule-report-${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
        }

        // Auto-save functionality
        function startAutoSave() {
            setInterval(() => {
                saveData();
            }, 30000); // Auto-save every 30 seconds
        }

        // Start the application
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            startAutoSave();
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) {
                switch (e.key) {
                    case 's':
                        e.preventDefault();
                        saveData();
                        break;
                    case 'r':
                        e.preventDefault();
                        if (confirm('Reset all data?')) {
                            resetAllData();
                        }
                        break;
                    case 'e':
                        e.preventDefault();
                        exportData();
                        break;
                }
            }
        });
    </script>
</body>
</html>
