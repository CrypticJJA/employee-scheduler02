<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Shift Scheduling System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .shift-night { background: linear-gradient(135deg, #1e3a8a, #3730a3); }
        .shift-morning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .shift-late { background: linear-gradient(135deg, #059669, #047857); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .calendar-day {
            background: white;
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        
        .calendar-day:hover {
            background: #f3f4f6;
        }
        
        .calendar-day.disabled {
            background: #f9fafb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        
        .calendar-day.selected {
            background: #3b82f6;
            color: white;
        }
        
        .calendar-day.in-range {
            background: #dbeafe;
            color: #1d4ed8;
        }
        
        .calendar-day.start-range, .calendar-day.end-range {
            background: #3b82f6;
            color: white;
        }
        
        .employee-card {
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .employee-card.assigned {
            background: #f0f9ff;
            border-color: #3b82f6;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success { background: #10b981; }
        .notification.error { background: #ef4444; }
        .notification.info { background: #3b82f6; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div class="max-w-7xl mx-auto p-6">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                Multi-Shift Scheduling System
            </h1>
            <p class="text-gray-600">Manage your team shifts with intelligent scheduling</p>
        </div>

        <!-- Quick Actions Bar -->
        <div class="bg-white rounded-xl shadow-lg p-4 mb-6 flex flex-wrap gap-3 justify-center">
            <button onclick="exportData()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-colors text-sm font-medium">
                üìä Export Data
            </button>
            <label class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition-colors text-sm font-medium cursor-pointer">
                üìÅ Import Data
                <input type="file" accept=".json" onchange="importData(event)" class="hidden">
            </label>
            <button onclick="generateScheduleReport()" class="bg-purple-500 text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-sm font-medium">
                üìã Generate Report
            </button>
            <button onclick="autoAssignShifts()" class="bg-orange-500 text-white px-4 py-2 rounded-lg hover:bg-orange-600 transition-colors text-sm font-medium">
                ü§ñ Auto Assign
            </button>
            <button onclick="resetAllData()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors text-sm font-medium">
                üîÑ Reset All
            </button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Component 1 - Shift Assignment -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                    Shift Assignment
                </h2>

                <!-- Date Range Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Select Date Range</label>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <!-- Calendar Header -->
                        <div class="flex items-center justify-between mb-4">
                            <button id="prevMonth" class="p-2 hover:bg-white rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                                </svg>
                            </button>
                            <h3 id="currentMonth" class="text-lg font-semibold"></h3>
                            <button id="nextMonth" class="p-2 hover:bg-white rounded-lg transition-colors">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                                </svg>
                            </button>
                        </div>
                        
                        <!-- Day Headers -->
                        <div class="calendar-grid mb-1">
                            <div class="calendar-day disabled font-semibold text-xs">Sun</div>
                            <div class="calendar-day disabled font-semibold text-xs">Mon</div>
                            <div class="calendar-day disabled font-semibold text-xs">Tue</div>
                            <div class="calendar-day disabled font-semibold text-xs">Wed</div>
                            <div class="calendar-day disabled font-semibold text-xs">Thu</div>
                            <div class="calendar-day disabled font-semibold text-xs">Fri</div>
                            <div class="calendar-day disabled font-semibold text-xs">Sat</div>
                        </div>
                        
                        <!-- Calendar Days -->
                        <div id="calendarDays" class="calendar-grid"></div>
                        
                        <!-- Selected Range Display -->
                        <div id="selectedRange" class="mt-4 p-3 bg-blue-50 rounded-lg text-sm text-blue-800 hidden">
                            <strong>Selected:</strong> <span id="rangeText"></span>
                        </div>
                    </div>
                </div>

                <!-- Shift Type Selection -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">Shift Type</label>
                    <div class="grid grid-cols-1 gap-3">
                        <div class="shift-type-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition-all" data-shift="night">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 shift-night rounded-lg flex items-center justify-center text-white text-xl">üåô</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">Night Shift</h3>
                                    <p class="text-sm text-gray-600">22:30 - 06:30</p>
                                </div>
                                <div class="text-sm text-gray-500" id="nightCount">0 assigned</div>
                            </div>
                        </div>
                        <div class="shift-type-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-orange-500 transition-all" data-shift="morning">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 shift-morning rounded-lg flex items-center justify-center text-white text-xl">‚òÄÔ∏è</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">Morning Shift</h3>
                                    <p class="text-sm text-gray-600">06:30 - 14:30</p>
                                </div>
                                <div class="text-sm text-gray-500" id="morningCount">0 assigned</div>
                            </div>
                        </div>
                        <div class="shift-type-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-green-500 transition-all" data-shift="late">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 shift-late rounded-lg flex items-center justify-center text-white text-xl">üåÜ</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">Late Shift</h3>
                                    <p class="text-sm text-gray-600">14:30 - 22:30</p>
                                </div>
                                <div class="text-sm text-gray-500" id="lateCount">0 assigned</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Available Employees -->
                <div id="availableEmployees" class="hidden animate-fade-in">
                    <div class="flex items-center justify-between mb-4">
                        <label class="text-sm font-medium text-gray-700">Available Employees</label>
                        <div class="flex gap-2">
                            <button id="smartAssignBtn" class="text-sm bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                                üß† Smart Assign
                            </button>
                            <button id="assignAllBtn" class="text-sm bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                                Assign All
                            </button>
                        </div>
                    </div>
                    <div id="employeesList" class="grid grid-cols-1 gap-3 max-h-60 overflow-y-auto"></div>
                </div>
            </div>

            <!-- Component 2 - Schedule Overview -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Schedule Overview
                </h2>

                <!-- Shift Tabs -->
                <div class="flex bg-gray-100 rounded-lg p-1 mb-6">
                    <button class="shift-tab flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all active" data-shift="night">
                        üåô Night Shift
                    </button>
                    <button class="shift-tab flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" data-shift="morning">
                        ‚òÄÔ∏è Morning Shift
                    </button>
                    <button class="shift-tab flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all" data-shift="late">
                        üåÜ Late Shift
                    </button>
                </div>

                <!-- Schedule Content -->
                <div id="scheduleContent" class="space-y-4 max-h-96 overflow-y-auto"></div>

                <!-- Summary Stats -->
                <div class="mt-6 grid grid-cols-3 gap-4">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div id="totalEmployees" class="text-2xl font-bold text-blue-600">0</div>
                        <div class="text-sm text-blue-800">Total Employees</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div id="totalAssignments" class="text-2xl font-bold text-green-600">0</div>
                        <div class="text-sm text-green-800">Assignments</div>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <div id="avgShifts" class="text-2xl font-bold text-purple-600">0</div>
                        <div class="text-sm text-purple-800">Avg/Employee</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Employee Management Panel -->
        <div class="mt-8 bg-white rounded-2xl shadow-xl p-6">
    <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
        <svg class="w-6 h-6 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
        </svg>
        Employee Profiles
    </h2>
    
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="employeeStats"></div>
</div>
        
    <script>
        // Application State
        let scheduleData = {
            employees: [],
            shifts: {
                night: { name: 'Night Shift', time: '22:30-06:30', icon: 'üåô', assignments: {} },
                morning: { name: 'Morning Shift', time: '06:30-14:30', icon: '‚òÄÔ∏è', assignments: {} },
                late: { name: 'Late Shift', time: '14:30-22:30', icon: 'üåÜ', assignments: {} }
            }
        };

        let currentDate = new Date(2025, 5, 1); // June 2025
        let selectedStartDate = null;
        let selectedEndDate = null;
        let selectedShift = null;
        let activeTab = 'night';

        // Working days in June 2025
        const workingDays = [
            '2025-06-02', '2025-06-03', '2025-06-04', '2025-06-05', '2025-06-06',
            '2025-06-09', '2025-06-10', '2025-06-11', '2025-06-12', '2025-06-13',
            '2025-06-16', '2025-06-17', '2025-06-18', '2025-06-19', '2025-06-20',
            '2025-06-23', '2025-06-24'
        ];

        // Initialize default employees
        function initializeEmployees() {
            const defaultEmployees = [
                { name: 'Naruto Uzumaki', group: '' },
                { name: 'Devaganga K', group: '' },
                { name: 'Kavya M', group: '' },
                { name: 'Adarsh J', group: '' },
                { name: 'Divya S', group: '' },
                { name: 'Aleena J', group: '' },
                { name: 'Emily E', group: '' },
                { name: 'Sanjay G', group: '' },
                { name: 'Jefferson A', group: '' },
                { name: 'Jerome B', group: '' },
                { name: 'Aswathi P', group: '' },
                { name: 'Joseph J', group: '' },
                { name: 'Tilmeezur R', group: '' },
                { name: 'Justyna S', group: '' },
                { name: 'Vishnu B', group: '' },
                { name: 'Bony R', group: '' },
                { name: 'Kattackakathu N', group: '' }
            ];

            scheduleData.employees = defaultEmployees.map(emp => ({
                ...emp,
                totalShifts: 0,
                shiftBreakdown: { night: 0, morning: 0, late: 0 }
            }));
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        // Calendar Functions
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        function isWorkingDay(dateStr) {
            return workingDays.includes(dateStr);
        }

        function isDateInRange(date, start, end) {
            if (!start || !end) return false;
            return date >= start && date <= end;
        }

        function renderCalendar() {
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            document.getElementById('currentMonth').textContent = 
                new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(currentDate);

            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());

            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';

            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dateStr = formatDate(date);
                const isCurrentMonth = date.getMonth() === month;
                const isWorking = isWorkingDay(dateStr);
                const isSelected = (selectedStartDate && date.getTime() === selectedStartDate.getTime()) ||
                                  (selectedEndDate && date.getTime() === selectedEndDate.getTime());
                const isInRange = selectedStartDate && selectedEndDate && 
                                  isDateInRange(date, selectedStartDate, selectedEndDate);

                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                dayElement.dataset.date = dateStr;

                if (!isCurrentMonth || !isWorking) {
                    dayElement.classList.add('disabled');
                } else {
                    if (isSelected) {
                        dayElement.classList.add(selectedStartDate && date.getTime() === selectedStartDate.getTime() ? 'start-range' : 'end-range');
                    } else if (isInRange) {
                        dayElement.classList.add('in-range');
                    }

                    dayElement.addEventListener('click', () => selectDate(date));
                }

                calendarDays.appendChild(dayElement);
            }
        }

        function selectDate(date) {
            if (!selectedStartDate || (selectedStartDate && selectedEndDate)) {
                selectedStartDate = new Date(date);
                selectedEndDate = null;
            } else {
                if (date < selectedStartDate) {
                    selectedEndDate = selectedStartDate;
                    selectedStartDate = new Date(date);
                } else {
                    selectedEndDate = new Date(date);
                }
            }

            updateSelectedRange();
            renderCalendar();
            updateAvailableEmployees();
            updateScheduleOverview();
            updateSummaryStats();
            updateShiftCounts();
        }

        function updateSelectedRange() {
            const rangeDiv = document.getElementById('selectedRange');
            const rangeText = document.getElementById('rangeText');

            if (selectedStartDate) {
                if (selectedEndDate) {
                    rangeText.textContent = `${selectedStartDate.toLocaleDateString()} - ${selectedEndDate.toLocaleDateString()}`;
                } else {
                    rangeText.textContent = selectedStartDate.toLocaleDateString();
                }
                rangeDiv.classList.remove('hidden');
            } else {
                rangeDiv.classList.add('hidden');
            }
        }

        // Calendar Navigation
        function setupCalendarNavigation() {
            document.getElementById('prevMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            document.getElementById('nextMonth').addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }

        // Shift Selection
        function setupShiftSelection() {
            document.querySelectorAll('.shift-type-card').forEach(card => {
                card.addEventListener('click', () => {
                    document.querySelectorAll('.shift-type-card').forEach(c => {
                        c.classList.remove('border-blue-500', 'border-orange-500', 'border-green-500', 'bg-blue-50', 'bg-orange-50', 'bg-green-50');
                        c.classList.add('border-gray-200');
                    });

                    const shift = card.dataset.shift;
                    selectedShift = shift;
                    
                    if (shift === 'night') {
                        card.classList.add('border-blue-500', 'bg-blue-50');
                    } else if (shift === 'morning') {
                        card.classList.add('border-orange-500', 'bg-orange-50');
                    } else if (shift === 'late') {
                        card.classList.add('border-green-500', 'bg-green-50');
                    }

                    updateAvailableEmployees();
                });
            });
        }

        // Employee Management
        function updateAvailableEmployees() {
            const container = document.getElementById('availableEmployees');
            const employeesList = document.getElementById('employeesList');

            if (!selectedStartDate || !selectedShift) {
                container.classList.add('hidden');
                return;
            }

            container.classList.remove('hidden');
            employeesList.innerHTML = '';

            const dateRange = getDateRange(selectedStartDate, selectedEndDate || selectedStartDate);
            const availableEmployees = getAvailableEmployees(dateRange, selectedShift);

            // Group employees by A & B
    const groupA = availableEmployees.filter(emp => emp.group === 'A');
    const groupB = availableEmployees.filter(emp => emp.group === 'B');

    // Create Group A section
    if (groupA.length > 0) {
        const groupADiv = document.createElement('div');
        groupADiv.className = 'mb-4';
        groupADiv.innerHTML = `
            <h4 class="font-semibold text-gray-700 mb-3 px-2">Group A</h4>
            <div class="space-y-2">
                ${groupA.map(emp => `
                    <div class="employee-card p-3 border-2 border-gray-200 rounded-lg flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                ${emp.name.charAt(0)}
                            </div>
                            <span class="font-medium text-gray-800">${emp.name}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="assign-btn bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors" data-employee="${emp.name}">
                                Assign
                            </button>
                            <button class="change-group-btn bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600 transition-colors" data-employee="${emp.name}" data-current-group="A">
                                Change Group
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        employeesList.appendChild(groupADiv);
    }

    // Create Group B section
    if (groupB.length > 0) {
        const groupBDiv = document.createElement('div');
        groupBDiv.className = 'mb-4';
        groupBDiv.innerHTML = `
            <h4 class="font-semibold text-gray-700 mb-3 px-2">Group B</h4>
            <div class="space-y-2">
                ${groupB.map(emp => `
                    <div class="employee-card p-3 border-2 border-gray-200 rounded-lg flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 bg-gradient-to-r from-green-500 to-teal-500 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                                ${emp.name.charAt(0)}
                            </div>
                            <span class="font-medium text-gray-800">${emp.name}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="assign-btn bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition-colors" data-employee="${emp.name}">
                                Assign
                            </button>
                            <button class="change-group-btn bg-gray-500 text-white px-3 py-1 rounded text-sm hover:bg-gray-600 transition-colors" data-employee="${emp.name}" data-current-group="B">
                                Change Group
                            </button>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        employeesList.appendChild(groupBDiv);
    }

    // Add event listeners for assign buttons
    document.querySelectorAll('.assign-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const employeeName = btn.dataset.employee;
            assignEmployeeToShift(employeeName, dateRange, selectedShift);
        });
    });

    // Add event listeners for change group buttons
    document.querySelectorAll('.change-group-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const employeeName = btn.dataset.employee;
            const currentGroup = btn.dataset.currentGroup;
            const newGroup = currentGroup === 'A' ? 'B' : 'A';
            changeEmployeeGroup(employeeName, newGroup);
        });
    });
            availableEmployees.forEach(emp => {
                const empDiv = document.createElement('div');
                empDiv.className = 'employee-card p-3 border-2 border-gray-200 rounded-lg flex items-center justify-between';
                empDiv.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold">
                            ${emp.name.charAt(0)}
                        </div>
                        <div>
                            <div class="font-medium text-gray-800">${emp.name}</div>
                            <div class="text-sm text-gray-600">Group ${emp.group} ‚Ä¢ ${emp.totalShifts} shifts</div>
                        </div>
                    </div>
                    <button class="assign-btn bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors text-sm" data-employee="${emp.name}">
                        Assign
                    </button>
                `;

                empDiv.querySelector('.assign-btn').addEventListener('click', () => {
                    assignEmployeeToShift(emp.name, dateRange, selectedShift);
                });

                employeesList.appendChild(empDiv);
            });

            // Assign buttons
            document.getElementById('assignAllBtn').onclick = () => {
                availableEmployees.forEach(emp => {
                    assignEmployeeToShift(emp.name, dateRange, selectedShift);
                });
            };

            document.getElementById('smartAssignBtn').onclick = () => {
                smartAssignEmployees(dateRange, selectedShift);
            };
        }

        function changeEmployeeGroup(employeeName, newGroup) {
    const employee = scheduleData.employees.find(emp => emp.name === employeeName);
    if (employee) {
        employee.group = newGroup;
        updateAvailableEmployees();
        updateScheduleOverview();
        updateEmployeeStats();
        showNotification(`${employeeName} moved to Group ${newGroup}`, 'success');
        
        // Force re-render calendar to update any group-specific displays
        renderCalendar();
    }
}
        
        function getDateRange(start, end) {
            const dates = [];
            const current = new Date(start);
            
            while (current <= end) {
                const dateStr = formatDate(current);
                if (isWorkingDay(dateStr)) {
                    dates.push(dateStr);
                }
                current.setDate(current.getDate() + 1);
            }
            
            return dates;
        }

        function getAvailableEmployees(dateRange, shiftType) {
            return scheduleData.employees.filter(emp => {
                return !dateRange.some(date => {
                    const assignments = scheduleData.shifts[shiftType].assignments[date] || [];
                    return assignments.includes(emp.name);
                });
            }).sort((a, b) => a.totalShifts - b.totalShifts);
        }

        function assignEmployeeToShift(employeeName, dateRange, shiftType) {
            let assignedCount = 0;
            dateRange.forEach(date => {
                if (!scheduleData.shifts[shiftType].assignments[date]) {
                    scheduleData.shifts[shiftType].assignments[date] = [];
                }
                
                if (!scheduleData.shifts[shiftType].assignments[date].includes(employeeName)) {
                    scheduleData.shifts[shiftType].assignments[date].push(employeeName);
                    assignedCount++;
                    
                    
                    const employee = scheduleData.employees.find(emp => emp.name === employeeName);
                    if (employee) {
                        employee.totalShifts++;
                        employee.shiftBreakdown[shiftType]++;
                    }
                }
            });

            if (assignedCount > 0) {
                showNotification(`${employeeName} assigned to ${assignedCount} ${shiftType} shift(s)`, 'success');

            // CONTINUATION FROM: showNotification(`${employeeName} assigned to ${assignedCount} ${shiftType} shift(s)`, 'success');

                updateAvailableEmployees();
                updateScheduleOverview();
                updateSummaryStats();
                updateShiftCounts();
                updateEmployeeStats();
            }
        }

        function smartAssignEmployees(dateRange, shiftType) {
    const availableEmployees = getAvailableEmployees(dateRange, shiftType);
    
    // Group employees by their groups
    const groupedEmployees = {
        'A': availableEmployees.filter(emp => emp.group === 'A'),
        'B': availableEmployees.filter(emp => emp.group === 'B'),
        'C': availableEmployees.filter(emp => emp.group === 'C')
    };

    let groupIndex = 0;
    const groups = ['A', 'B', 'C'];
    
    dateRange.forEach((date, index) => {
        // Rotate through groups for each date
        const currentGroup = groups[groupIndex % groups.length];
        const groupEmployees = groupedEmployees[currentGroup];
        
        if (groupEmployees.length > 0) {
            // Take first 3 employees from the group
            const employeesToAssign = groupEmployees.slice(0, 3);
            employeesToAssign.forEach(emp => {
                assignEmployeeToShift(emp.name, [date], shiftType);
            });
            
            // Move to next group for next date
            groupIndex++;
        }
    });
    
    showNotification(`Smart assignment completed for ${shiftType} shift (Group rotation)`, 'success');
}
        
        // Schedule Overview Functions
        function setupShiftTabs() {
            document.querySelectorAll('.shift-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.shift-tab').forEach(t => {
                        t.classList.remove('active', 'bg-white', 'text-blue-600', 'shadow-sm');
                        t.classList.add('text-gray-600');
                    });
                    
                    tab.classList.add('active', 'bg-white', 'text-blue-600', 'shadow-sm');
                    tab.classList.remove('text-gray-600');
                    
                    activeTab = tab.dataset.shift;
                    updateScheduleOverview();
                });
            });
        }

function updateScheduleOverview() {
    const scheduleContent = document.getElementById('scheduleContent');
    const shiftData = scheduleData.shifts[activeTab];
    
    scheduleContent.innerHTML = '';

    // Get sorted dates for this shift
    const sortedDates = Object.keys(shiftData.assignments).sort();

    if (sortedDates.length === 0) {
        // Show empty state
        return;
    }

    sortedDates.forEach(date => {
        const dateObj = new Date(date + 'T00:00:00');
        const assignments = shiftData.assignments[date];
        
        // Create date section
        const dateSection = document.createElement('div');
        dateSection.className = 'bg-gray-50 rounded-lg p-4 mb-4';
        dateSection.innerHTML = `
            <div class="flex justify-between items-center mb-3">
                <h3 class="font-semibold">
                    ${dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}
                </h3>
                <span class="text-sm text-gray-600">${assignments.length} employees</span>
            </div>
            <div class="grid grid-cols-1 gap-2">
                ${assignments.map(empName => {
                    const employee = scheduleData.employees.find(e => e.name === empName);
                    return `
                        <div class="flex items-center justify-between bg-white p-2 rounded border">
                            <div class="flex items-center gap-2">
                                <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-xs">
                                    ${empName.charAt(0)}
                                </div>
                                <span class="text-sm">${empName}</span>
                                <span class="text-xs text-gray-500">Group ${employee?.group}</span>
                            </div>
                            <button onclick="removeEmployeeFromShift('${empName}', '${date}', '${activeTab}')" class="text-red-500 hover:text-red-700 text-xs">
                                Remove
                            </button>
                        </div>
                    `;
                }).join('')}
            </div>
        `;
        
        scheduleContent.appendChild(dateSection);
    });
}    
    // Group assigned employees by their groups
    const groupA = [];
    const groupB = [];
    
    assignedEmployees.forEach(empName => {
        const employee = scheduleData.employees.find(e => e.name === empName);
        if (employee) {
            if (employee.group === 'A') {
                groupA.push(employee);
            } else {
                groupB.push(employee);
            }
        }
    });
    
    // Create Group A section
    if (groupA.length > 0) {
        const groupADiv = document.createElement('div');
        groupADiv.className = 'bg-blue-50 rounded-lg p-4 border border-blue-200 mb-4';
        groupADiv.innerHTML = `
            <h3 class="font-semibold text-blue-800 mb-3 flex items-center gap-2">
                <div class="w-6 h-6 bg-blue-600 rounded-full flex items-center justify-center text-white text-sm font-bold">A</div>
                Group A (${groupA.length} employees)
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                ${groupA.map(emp => `
                    <div class="flex items-center justify-between bg-white p-2 rounded border">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-xs font-semibold">
                                ${emp.name.charAt(0)}
                            </div>
                            <span class="text-sm font-medium">${emp.name}</span>
                        </div>
                        <button class="text-red-500 hover:text-red-700 text-xs" onclick="removeEmployeeFromAllShifts('${emp.name}', '${activeTab}')">
                            Remove
                        </button>
                    </div>
                `).join('')}
            </div>
        `;
        scheduleContent.appendChild(groupADiv);
    }
    
    // Create Group B section
    if (groupB.length > 0) {
        const groupBDiv = document.createElement('div');
        groupBDiv.className = 'bg-green-50 rounded-lg p-4 border border-green-200';
        groupBDiv.innerHTML = `
            <h3 class="font-semibold text-green-800 mb-3 flex items-center gap-2">
                <div class="w-6 h-6 bg-green-600 rounded-full flex items-center justify-center text-white text-sm font-bold">B</div>
                Group B (${groupB.length} employees)
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                ${groupB.map(emp => `
                    <div class="flex items-center justify-between bg-white p-2 rounded border">
                        <div class="flex items-center gap-2">
                            <div class="w-6 h-6 bg-gradient-to-r from-green-500 to-teal-500 rounded-full flex items-center justify-center text-white text-xs font-semibold">
                                ${emp.name.charAt(0)}
                            </div>
                            <span class="text-sm font-medium">${emp.name}</span>
                        </div>
                        <button class="text-red-500 hover:text-red-700 text-xs" onclick="removeEmployeeFromAllShifts('${emp.name}', '${activeTab}')">
                            Remove
                        </button>
                    </div>
                `).join('')}
            </div>
        `;
        scheduleContent.appendChild(groupBDiv);
    }
}
            
            const sortedDates = Object.keys(shiftData.assignments).sort();
            
            if (sortedDates.length === 0) {
                scheduleContent.innerHTML = `
                    <div class="text-center py-12 text-gray-500">
                        <svg class="w-16 h-16 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        <p class="text-lg font-medium mb-2">No ${shiftData.name} assignments yet</p>
                        <p class="text-sm">Select dates and assign employees to get started</p>
                    </div>
                `;
                return;
            }
            
            sortedDates.forEach(date => {
                const assignments = shiftData.assignments[date] || [];
                const dateObj = new Date(date + 'T00:00:00');
                
                const dateDiv = document.createElement('div');
                dateDiv.className = 'bg-gray-50 rounded-lg p-4 border border-gray-200';
                dateDiv.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-800">
                            ${dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}
                        </h3>
                        <div class="flex items-center gap-2">
                            <span class="text-sm text-gray-600">${assignments.length} assigned</span>
                            <button class="text-red-500 hover:text-red-700 text-sm font-medium" onclick="clearDateAssignments('${date}', '${activeTab}')">
                                Clear All
                            </button>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-2">
                        ${assignments.map(empName => {
                            const employee = scheduleData.employees.find(e => e.name === empName);
                            return `
                                <div class="flex items-center justify-between bg-white p-2 rounded border">
                                    <div class="flex items-center gap-2">
                                        <div class="w-6 h-6 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white text-xs font-semibold">
                                            ${empName.charAt(0)}
                                        </div>
                                        <span class="text-sm font-medium">${empName}</span>
                                        <span class="text-xs text-gray-500">Group ${employee?.group || 'N/A'}</span>
                                    </div>
                                    <button class="text-red-500 hover:text-red-700 text-xs" onclick="removeEmployeeFromShift('${empName}', '${date}', '${activeTab}')">
                                        Remove
                                    </button>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
                
                scheduleContent.appendChild(dateDiv);
            });
        }

            function clearDateAssignments(date, shiftType) {
                const assignments = scheduleData.shifts[shiftType].assignments[date] || [];
                
                assignments.forEach(empName => {
                    const employee = scheduleData.employees.find(emp => emp.name === empName);
                    if (employee) {
                        employee.totalShifts--;
                        employee.shiftBreakdown[shiftType]--;
                    });
                
                function clearDateAssignments(date, shiftType) {
                    const assignments = scheduleData.shifts[shiftType].assignments[date] || [];
                    assignments.forEach(empName => {
                        const employee = scheduleData.employees.find(emp => emp.name === empName);
                        if (employee) {
                            employee.totalShifts--;
                            employee.shiftBreakdown[shiftType]--;
                        }
                    });
                    
                    if (removedCount > 0) {
                        const employee = scheduleData.employees.find(emp => emp.name === empName);
                        if (employee) {
                            employee.totalShifts -= removedCount;
                            employee.shiftBreakdown[shiftType] = Math.max(0, employee.shiftBreakdown[shiftType] - removedCount);
                        }
                    }
                    
                    delete scheduleData.shifts[shiftType].assignments[date];
        
        updateScheduleOverview();
        updateSummaryStats();
        updateShiftCounts();
        updateEmployeeStats();
        updateAvailableEmployees();
        
        showNotification(`Cleared all assignments for ${date}`, 'info');
    }

        function removeEmployeeFromShift(empName, date, shiftType) {
            const assignments = scheduleData.shifts[shiftType].assignments[date] || [];
            const index = assignments.indexOf(empName);
            
            if (index > -1) {
                assignments.splice(index, 1);
                
                const employee = scheduleData.employees.find(emp => emp.name === empName);
                if (employee) {
                    employee.totalShifts--;
                    employee.shiftBreakdown[shiftType]--;
                }
                
                if (assignments.length === 0) {
                    delete scheduleData.shifts[shiftType].assignments[date];
                }
                
                updateScheduleOverview();
                updateSummaryStats();
                updateShiftCounts();
                updateEmployeeStats();
                updateAvailableEmployees();
                
                showNotification(`${empName} removed from shift`, 'info');
            }
        }

        // Statistics Functions
        function updateSummaryStats() {
            const totalEmployees = scheduleData.employees.length;
            const totalAssignments = Object.values(scheduleData.shifts).reduce((total, shift) => {
                return total + Object.values(shift.assignments).reduce((shiftTotal, assignments) => {
                    return shiftTotal + assignments.length;
                }, 0);
            }, 0);
            
            const avgShifts = totalEmployees > 0 ? (totalAssignments / totalEmployees).toFixed(1) : 0;
            
            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('totalAssignments').textContent = totalAssignments;
            document.getElementById('avgShifts').textContent = avgShifts;
        }

        function updateShiftCounts() {
            Object.keys(scheduleData.shifts).forEach(shiftType => {
                const uniqueEmployees = new Set();
                Object.values(scheduleData.shifts[shiftType].assignments).forEach(assignments => {
            assignments.forEach(emp => uniqueEmployees.add(emp));
        });
                document.getElementById(`${shiftType}Count`).textContent = `${uniqueEmployees.size} assigned`;
            });
        }

            // Update employee statistics to show profiles instead of shift stats
function updateEmployeeStats() {
    const statsContainer = document.getElementById('employeeStats');
    statsContainer.innerHTML = '';
    
    // Add "Add New Employee" button first
    const addEmployeeCard = document.createElement('div');
    addEmployeeCard.className = 'bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg p-6 border-2 border-dashed border-blue-300 cursor-pointer hover:from-blue-600 hover:to-purple-600 transition-all';
    addEmployeeCard.innerHTML = `
        <div class="text-center text-white">
            <svg class="w-12 h-12 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
            </svg>
            <h3 class="text-lg font-semibold mb-1">Add New Employee</h3>
            <p class="text-sm opacity-90">Click to add a new team member</p>
        </div>
    `;
    addEmployeeCard.addEventListener('click', showAddEmployeeModal);
    statsContainer.appendChild(addEmployeeCard);
    
    // Add existing employees
    scheduleData.employees.forEach(emp => {
        const profileCard = document.createElement('div');
        profileCard.className = 'bg-white rounded-lg p-4 border border-gray-200 shadow-sm';
        profileCard.innerHTML = `
            <div class="flex items-start justify-between mb-4">
                <div class="flex items-center gap-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-semibold">
                        ${emp.name.charAt(0)}
                    </div>
                    <div>
                        <h3 class="font-semibold text-gray-800">${emp.name}</h3>
                        <p class="text-sm text-gray-600">Group ${emp.group}</p>
                    </div>
                </div>
                <button class="text-red-500 hover:text-red-700 text-sm" onclick="deleteEmployee('${emp.name}')">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                    </svg>
                </button>
            </div>
            <div class="space-y-3">
                <div>
                    <label class="text-xs font-medium text-gray-600">Full Name</label>
                    <input type="text" class="w-full p-2 text-sm border border-gray-300 rounded mt-1" 
                           placeholder="Enter full name" value="${emp.fullName || ''}" 
                           onchange="updateEmployeeField('${emp.name}', 'fullName', this.value)">
                </div>
                <div>
                    <label class="text-xs font-medium text-gray-600">Phone</label>
                    <input type="tel" class="w-full p-2 text-sm border border-gray-300 rounded mt-1" 
                           placeholder="Enter phone number" value="${emp.phone || ''}"
                           onchange="updateEmployeeField('${emp.name}', 'phone', this.value)">
                </div>
                <div>
                    <label class="text-xs font-medium text-gray-600">Email</label>
                    <input type="email" class="w-full p-2 text-sm border border-gray-300 rounded mt-1" 
                           placeholder="Enter email address" value="${emp.email || ''}"
                           onchange="updateEmployeeField('${emp.name}', 'email', this.value)">
                </div>
            </div>
        `;
        
        statsContainer.appendChild(profileCard);
    });
}

// New function to show add employee modal
function showAddEmployeeModal() {
    const modal = document.createElement('div');
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
    modal.innerHTML = `
        <div class="bg-white rounded-lg p-6 w-96 max-w-90vw">
            <h3 class="text-lg font-semibold mb-4">Add New Employee</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Employee Name</label>
                    <input type="text" id="newEmpName" class="w-full p-2 border border-gray-300 rounded" placeholder="Enter employee name">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Group</label>
                    <select id="newEmpGroup" class="w-full p-2 border border-gray-300 rounded">
                        <option value="A">Group A</option>
                        <option value="B">Group B</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="newEmpFullName" class="w-full p-2 border border-gray-300 rounded" placeholder="Enter full name">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
                    <input type="tel" id="newEmpPhone" class="w-full p-2 border border-gray-300 rounded" placeholder="Enter phone number">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                    <input type="email" id="newEmpEmail" class="w-full p-2 border border-gray-300 rounded" placeholder="Enter email address">
                </div>
            </div>
            <div class="flex gap-3 mt-6">
                <button class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors" onclick="addNewEmployee()">
                    Add Employee
                </button>
                <button class="flex-1 bg-gray-500 text-white py-2 px-4 rounded hover:bg-gray-600 transition-colors" onclick="closeModal()">
                    Cancel
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    document.getElementById('newEmpName').focus();
}

// New function to add employee
function addNewEmployee() {
    const name = document.getElementById('newEmpName').value.trim();
    const group = document.getElementById('newEmpGroup').value;
    const fullName = document.getElementById('newEmpFullName').value.trim();
    const phone = document.getElementById('newEmpPhone').value.trim();
    const email = document.getElementById('newEmpEmail').value.trim();
    
    if (!name) {
        showNotification('Employee name is required', 'error');
        return;
    }
    
    // Check if employee already exists
    if (scheduleData.employees.some(emp => emp.name === name)) {
        showNotification('Employee with this name already exists', 'error');
        return;
    }
    
    const newEmployee = {
        name: name,
        group: group,
        totalShifts: 0,
        shiftBreakdown: { night: 0, morning: 0, late: 0 },
        fullName: fullName,
        phone: phone,
        email: email
    };
    
    scheduleData.employees.push(newEmployee);
    
    closeModal();
    updateEmployeeStats();
    updateSummaryStats();
    updateAvailableEmployees();
    
    showNotification(`${name} added successfully`, 'success');
}

// New function to close modal
function closeModal() {
    const modal = document.querySelector('.fixed.inset-0');
    if (modal) {
        document.body.removeChild(modal);
    }
}

// New function to update employee field
function updateEmployeeField(empName, field, value) {
    const employee = scheduleData.employees.find(emp => emp.name === empName);
    if (employee) {
        employee[field] = value;
        showNotification(`${empName}'s ${field} updated`, 'success');
    }
}

// New function to delete employee
function deleteEmployee(empName) {
    if (!confirm(`Are you sure you want to delete ${empName}? This will remove them from all shifts.`)) {
        return;
    }
    
    // Remove from all shifts
    Object.keys(scheduleData.shifts).forEach(shiftType => {
        Object.keys(scheduleData.shifts[shiftType].assignments).forEach(date => {
            const assignments = scheduleData.shifts[shiftType].assignments[date];
            const index = assignments.indexOf(empName);
            if (index > -1) {
                assignments.splice(index, 1);
                if (assignments.length === 0) {
                    delete scheduleData.shifts[shiftType].assignments[date];
                }
            }
        });
    });
    
    // Remove from employees array
    const empIndex = scheduleData.employees.findIndex(emp => emp.name === empName);
    if (empIndex > -1) {
        scheduleData.employees.splice(empIndex, 1);
    }
    
    updateEmployeeStats();
    updateScheduleOverview();
    updateSummaryStats();
    updateShiftCounts();
    updateAvailableEmployees();
    
    showNotification(`${empName} deleted successfully`, 'info');
}
                        
                        showNotification('Schedule data imported successfully', 'success');
                    } else {
                        throw new Error('Invalid file format');
                    }
                } catch (error) {
                    showNotification('Error importing data: Invalid file format', 'error');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        function generateScheduleReport() {
            let report = "SHIFT SCHEDULE REPORT\n";
            report += "=".repeat(50) + "\n";
            report += `Generated: ${new Date().toLocaleString()}\n\n`;
            
            // Summary
            report += "SUMMARY:\n";
            report += `-`.repeat(20) + "\n";
            report += `Total Employees: ${scheduleData.employees.length}\n`;
            report += `Total Assignments: ${Object.values(scheduleData.shifts).reduce((total, shift) => {
                return total + Object.values(shift.assignments).reduce((shiftTotal, assignments) => {
                    return shiftTotal + assignments.length;
                }, 0);
            }, 0)}\n\n`;
            
            // Each shift type
            Object.keys(scheduleData.shifts).forEach(shiftType => {
                const shift = scheduleData.shifts[shiftType];
                report += `${shift.name.toUpperCase()} (${shift.time}):\n`;
                report += `-`.repeat(30) + "\n";
                
                const sortedDates = Object.keys(shift.assignments).sort();
                if (sortedDates.length === 0) {
                    report += "No assignments\n\n";
                } else {
                    sortedDates.forEach(date => {
                        const dateObj = new Date(date + 'T00:00:00');
                        report += `${dateObj.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' })}: `;
                        report += shift.assignments[date].join(', ') + "\n";
                    });
                    report += "\n";
                }
            });
            
            // Employee statistics
            report += "EMPLOYEE STATISTICS:\n";
            report += `-`.repeat(30) + "\n";
            const sortedEmployees = [...scheduleData.employees].sort((a, b) => b.totalShifts - a.totalShifts);
            sortedEmployees.forEach(emp => {
                report += `${emp.name} (Group ${emp.group}): ${emp.totalShifts} shifts `;
                report += `(Night: ${emp.shiftBreakdown.night}, Morning: ${emp.shiftBreakdown.morning}, Late: ${emp.shiftBreakdown.late})\n`;
            });
            
            // Download report
            const dataStr = "data:text/plain;charset=utf-8," + encodeURIComponent(report);
            const downloadElement = document.createElement('a');
            downloadElement.setAttribute("href", dataStr);
            downloadElement.setAttribute("download", `schedule_report_${new Date().toISOString().split('T')[0]}.txt`);
            document.body.appendChild(downloadElement);
            downloadElement.click();
            document.body.removeChild(downloadElement);
            
            showNotification('Schedule report generated and downloaded', 'success');
        }

        function autoAssignShifts() {
            if (!confirm('This will automatically assign employees to all available shifts. Continue?')) {
                return;
            }
            
            let totalAssignments = 0;
            
            // For each working day, assign employees to each shift type
            workingDays.forEach(date => {
                Object.keys(scheduleData.shifts).forEach(shiftType => {
                    const availableEmployees = scheduleData.employees.filter(emp => {
                        const assignments = scheduleData.shifts[shiftType].assignments[date] || [];
                        return !assignments.includes(emp.name);
                    }).sort((a, b) => a.totalShifts - b.totalShifts);
                    
                    // Assign 2-3 employees per shift based on availability
                    const employeesToAssign = Math.min(3, availableEmployees.length);
                    for (let i = 0; i < employeesToAssign; i++) {
                        assignEmployeeToShift(availableEmployees[i].name, [date], shiftType);
                        totalAssignments++;
                    }
                });
            });
            
            showNotification(`Auto-assignment completed: ${totalAssignments} assignments made`, 'success');
        }

        function resetAllData() {
            if (!confirm('This will reset all schedule data. Are you sure?')) {
                return;
            }
            
            // Reset assignments
            Object.keys(scheduleData.shifts).forEach(shiftType => {
                scheduleData.shifts[shiftType].assignments = {};
            });
            
            // Reset employee stats
            scheduleData.employees.forEach(emp => {
                emp.totalShifts = 0;
                emp.shiftBreakdown = { night: 0, morning: 0, late: 0 };
            });
            
            // Reset UI state
            selectedStartDate = null;
            selectedEndDate = null;
            selectedShift = null;
            
            // Update all UI components
            renderCalendar();
            updateScheduleOverview();
            updateSummaryStats();
            updateShiftCounts();
            updateEmployeeStats();
            updateAvailableEmployees();
            updateSelectedRange();
            
            // Reset shift selection
            document.querySelectorAll('.shift-type-card').forEach(card => {
                card.classList.remove('border-blue-500', 'border-orange-500', 'border-green-500', 'bg-blue-50', 'bg-orange-50', 'bg-green-50');
                card.classList.add('border-gray-200');
            });
            
            showNotification('All data has been reset', 'info');
        }

        // Initialize Application
        function initializeApp() {
            initializeEmployees();
            setupCalendarNavigation();
            setupShiftSelection();
            setupShiftTabs();
            renderCalendar();
            updateScheduleOverview();
            updateSummaryStats();
            updateShiftCounts();
            updateEmployeeStats();
            
            // Set initial active tab
            document.querySelector('.shift-tab[data-shift="night"]').classList.add('active', 'bg-white', 'text-blue-600', 'shadow-sm');
            document.querySelector('.shift-tab[data-shift="night"]').classList.remove('text-gray-600');
        }

        // Start the application when the page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
