<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Shift Scheduling System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .shift-night { background: linear-gradient(135deg, #1e3a8a, #3730a3); }
        .shift-morning { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .shift-late { background: linear-gradient(135deg, #059669, #047857); }
        .glass-effect { backdrop-filter: blur(10px); background: rgba(255, 255, 255, 0.1); }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .employee-card:hover { transform: translateY(-2px); transition: all 0.2s ease; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen">
    <div id="app" class="max-w-7xl mx-auto p-6 space-y-8">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">
                Multi-Shift Scheduling System
            </h1>
            <p class="text-gray-600">Manage night, morning, and late shifts with smart assignment</p>
        </div>

        <!-- Employee Management Section -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z"/>
                </svg>
                Employee Management
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Add Employee -->
                <div class="bg-green-50 rounded-xl p-4">
                    <h3 class="font-semibold text-green-800 mb-4">Add New Employee</h3>
                    <div class="space-y-3">
                        <input
                            type="text"
                            id="newEmployeeName"
                            placeholder="Employee Name"
                            class="w-full p-3 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"
                        />
                        <select id="newEmployeeGroup" class="w-full p-3 border border-green-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent">
                            <option value="">Select Group</option>
                            <option value="A">Group A</option>
                            <option value="B">Group B</option>
                            <option value="C">Group C</option>
                        </select>
                        <button
                            id="addEmployeeBtn"
                            class="w-full bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors font-medium"
                        >
                            ‚ûï Add Employee
                        </button>
                    </div>
                </div>

                <!-- Remove Employee -->
                <div class="bg-red-50 rounded-xl p-4">
                    <h3 class="font-semibold text-red-800 mb-4">Remove Employee</h3>
                    <div class="space-y-3">
                        <select id="removeEmployeeSelect" class="w-full p-3 border border-red-200 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent">
                            <option value="">Select Employee to Remove</option>
                        </select>
                        <button
                            id="removeEmployeeBtn"
                            class="w-full bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 transition-colors font-medium"
                            disabled
                        >
                            üóëÔ∏è Remove Employee
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shift Assignment Section -->
        <div class="bg-white rounded-2xl shadow-xl p-6 mb-8">
            <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
                Shift Assignment
            </h2>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- Date Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Select Date</label>
                    <select id="dateSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Choose Date</option>
                    </select>
                </div>

                <!-- Shift Type Selection -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Shift Type</label>
                    <select id="shiftTypeSelect" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select Shift</option>
                        <option value="night">üåô Night Shift (22:30-06:30)</option>
                        <option value="morning">‚òÄÔ∏è Morning Shift (06:30-14:30)</option>
                        <option value="late">üåÜ Late Shift (14:30-22:30)</option>
                    </select>
                </div>

                <!-- Required People -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Required People</label>
                    <input
                        type="number"
                        id="requiredPeople"
                        min="0"
                        max="20"
                        value="0"
                        class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    />
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Set Requirements -->
                <div class="bg-blue-50 rounded-xl p-4">
                    <h3 class="font-semibold text-blue-800 mb-3">Set Shift Requirements</h3>
                    <button
                        id="setRequirementBtn"
                        class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors font-medium disabled:bg-gray-400 disabled:cursor-not-allowed"
                        disabled
                    >
                        üìù Set Requirement
                    </button>
                </div>

                <!-- Manual Assignment -->
                <div class="bg-purple-50 rounded-xl p-4">
                    <h3 class="font-semibold text-purple-800 mb-3">Manual Assignment</h3>
                    <div class="space-y-3">
                        <select id="employeeSelect" class="w-full p-3 border border-purple-200 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" disabled>
                            <option value="">Choose Employee</option>
                        </select>
                        <button
                            id="assignEmployeeBtn"
                            class="w-full bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors font-medium disabled:bg-gray-400 disabled:cursor-not-allowed"
                            disabled
                        >
                            üë§ Assign Employee
                        </button>
                    </div>
                </div>
            </div>

            <!-- Smart Suggestions Panel -->
            <div id="suggestionsPanel" class="mt-6 p-4 bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl border-l-4 border-cyan-500 hidden animate-fade-in">
                <h3 class="font-semibold text-cyan-800 mb-3">ü§ñ Smart Suggestions (Fair Distribution)</h3>
                <p class="text-sm text-cyan-700 mb-4">Recommended employees based on current workload:</p>
                <div id="suggestedEmployeesList" class="grid grid-cols-1 md:grid-cols-2 gap-2 mb-4"></div>
                <div class="flex gap-3">
                    <button
                        id="autoAssignBtn"
                        class="bg-cyan-600 text-white px-6 py-2 rounded-lg hover:bg-cyan-700 transition-colors font-medium"
                    >
                        ‚ú® Auto-Assign All
                    </button>
                    <button
                        id="getSuggestionsBtn"
                        class="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition-colors font-medium"
                    >
                        üéØ Get Suggestions
                    </button>
                    <button
                        id="hideSuggestionsBtn"
                        class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors font-medium"
                    >
                        Hide
                    </button>
                </div>
            </div>
        </div>

        <!-- Schedule Overview -->
        <div class="grid grid-cols-1 xl:grid-cols-2 gap-8">
            <!-- Current Schedule -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                    </svg>
                    Schedule Overview
                </h2>
                <div id="scheduleOverview" class="space-y-4 max-h-96 overflow-y-auto"></div>
            </div>

            <!-- Employee Statistics -->
            <div class="bg-white rounded-2xl shadow-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                    <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Employee Statistics
                </h2>
                <div id="employeeStats" class="space-y-4"></div>
            </div>
        </div>

        <!-- Summary Dashboard -->
        <div class="bg-white rounded-2xl shadow-xl p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-6">üìä Summary Dashboard</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl text-center">
                    <div id="totalEmployees" class="text-2xl font-bold">0</div>
                    <div class="text-sm opacity-90">Total Employees</div>
                </div>
                <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl text-center">
                    <div id="totalAssignments" class="text-2xl font-bold">0</div>
                    <div class="text-sm opacity-90">Total Assignments</div>
                </div>
                <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-xl text-center">
                    <div id="avgShiftsPerPerson" class="text-2xl font-bold">0</div>
                    <div class="text-sm opacity-90">Avg Shifts/Person</div>
                </div>
                <div class="bg-gradient-to-r from-red-500 to-red-600 text-white p-4 rounded-xl text-center">
                    <div id="understaffedShifts" class="text-2xl font-bold">0</div>
                    <div class="text-sm opacity-90">Understaffed</div>
                </div>
            </div>
            
            <div class="text-center">
                <button
                    onclick="resetAllData()"
                    class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition-colors font-medium"
                >
                    üîÑ Reset All Data
                </button>
            </div>
        </div>
    </div>

    <script>
        // Application State
        let scheduleData = {
            dates: [],
            employees: [],
            shifts: {
                night: { name: 'Night Shift', time: '22:30-06:30', icon: 'üåô' },
                morning: { name: 'Morning Shift', time: '06:30-14:30', icon: '‚òÄÔ∏è' },
                late: { name: 'Late Shift', time: '14:30-22:30', icon: 'üåÜ' }
            }
        };

        let selectedDate = '';
        let selectedShift = '';

        // Initialize dates for June 2025 (working days only)
        function initializeDates() {
            const workingDates = [
                '02-06-2025', '03-06-2025', '04-06-2025', '05-06-2025', '06-06-2025',
                '09-06-2025', '10-06-2025', '11-06-2025', '12-06-2025', '13-06-2025',
                '16-06-2025', '17-06-2025', '18-06-2025', '19-06-2025', '20-06-2025',
                '23-06-2025', '24-06-2025'
            ];

            scheduleData.dates = workingDates.map(date => ({
                date,
                shifts: {
                    night: { required: 0, assigned: [] },
                    morning: { required: 0, assigned: [] },
                    late: { required: 0, assigned: [] }
                }
            }));
        }

        // Initialize default employees
        function initializeEmployees() {
            const defaultEmployees = [
                { name: 'Abhiram R', group: 'A' },
                { name: 'Devaganga K', group: 'A' },
                { name: 'Kavya M', group: 'A' },
                { name: 'Adarsh J', group: 'A' },
                { name: 'Divya S', group: 'A' },
                { name: 'Aleena J', group: 'A' },
                { name: 'Emily E', group: 'B' },
                { name: 'Sanjay G', group: 'B' },
                { name: 'Jefferson A', group: 'B' },
                { name: 'Jerome B', group: 'B' },
                { name: 'Aswathi P', group: 'B' },
                { name: 'Joseph J', group: 'B' },
                { name: 'Tilmeezur R', group: 'C' },
                { name: 'Justyna S', group: 'C' },
                { name: 'Vishnu B', group: 'C' },
                { name: 'Bony R', group: 'C' },
                { name: 'Kattackakathu N', group: 'C' }
            ];

            scheduleData.employees = defaultEmployees.map(emp => ({
                ...emp,
                totalShifts: 0,
                shiftBreakdown: { night: 0, morning: 0, late: 0 }
            }));
        }

        // Utility Functions
        function saveData() {
            const dataToSave = JSON.stringify(scheduleData);
            const compressedData = btoa(dataToSave);
            document.cookie = `scheduleData=${compressedData}; expires=${new Date(Date.now() + 30*24*60*60*1000).toUTCString()}; path=/`;
        }

        function loadData() {
            const cookies = document.cookie.split(';').map(c => c.trim());
            const dataCookie = cookies.find(c => c.startsWith('scheduleData='));
            
            if (dataCookie) {
                try {
                    const compressedData = dataCookie.split('=')[1];
                    const decompressedData = atob(compressedData);
                    scheduleData = JSON.parse(decompressedData);
                    return true;
                } catch (e) {
                    console.warn('Failed to load saved data:', e);
                }
            }
            return false;
        }

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function getSuggestedEmployees(dateStr, shiftType, requiredCount) {
            const targetDate = scheduleData.dates.find(d => d.date === dateStr);
            if (!targetDate || requiredCount === 0) return [];

            const currentlyAssigned = targetDate.shifts[shiftType].assigned;
            const availableEmployees = scheduleData.employees.filter(
                emp => !currentlyAssigned.includes(emp.name)
            );

            // Shuffle for fairness, then sort by total shifts
            const shuffled = shuffleArray(availableEmployees);
            const prioritized = shuffled.sort((a, b) => a.totalShifts - b.totalShifts);
            
            return prioritized.slice(0, Math.min(requiredCount, prioritized.length));
        }

        // DOM Management
        function populateDateSelect() {
            const dateSelect = document.getElementById('dateSelect');
            dateSelect.innerHTML = '<option value="">Choose Date</option>';
            
            scheduleData.dates.forEach(dateObj => {
                const option = document.createElement('option');
                option.value = dateObj.date;
                option.textContent = dateObj.date;
                dateSelect.appendChild(option);
            });
        }

        function populateEmployeeSelects() {
            const employeeSelect = document.getElementById('employeeSelect');
            const removeSelect = document.getElementById('removeEmployeeSelect');
            
            // Clear selects
            employeeSelect.innerHTML = '<option value="">Choose Employee</option>';
            removeSelect.innerHTML = '<option value="">Select Employee to Remove</option>';
            
            if (!selectedDate || !selectedShift) {
                employeeSelect.disabled = true;
                return;
            }

            const targetDate = scheduleData.dates.find(d => d.date === selectedDate);
            if (!targetDate) return;

            const currentlyAssigned = targetDate.shifts[selectedShift].assigned;
            const availableEmployees = scheduleData.employees.filter(
                emp => !currentlyAssigned.includes(emp.name)
            );

            // Sort available employees by total shifts for fair distribution
            const sortedEmployees = availableEmployees.sort((a, b) => a.totalShifts - b.totalShifts);

            sortedEmployees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.name;
                option.textContent = `${emp.name} (Group ${emp.group}) - ${emp.totalShifts} total shifts`;
                employeeSelect.appendChild(option);
            });

            // Populate remove select with all employees
            scheduleData.employees.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp.name;
                option.textContent = `${emp.name} (Group ${emp.group})`;
                removeSelect.appendChild(option);
            });

            employeeSelect.disabled = false;
        }

        // Employee Management
        function addEmployee() {
            const nameInput = document.getElementById('newEmployeeName');
            const groupSelect = document.getElementById('newEmployeeGroup');
            
            const name = nameInput.value.trim();
            const group = groupSelect.value;
            
            if (!name || !group) {
                alert('Please enter both name and group');
                return;
            }

            if (scheduleData.employees.some(emp => emp.name === name)) {
                alert('Employee with this name already exists');
                return;
            }

            scheduleData.employees.push({
                name,
                group,
                totalShifts: 0,
                shiftBreakdown: { night: 0, morning: 0, late: 0 }
            });

            nameInput.value = '';
            groupSelect.value = '';
            
            updateUI();
            saveData();
            
            // Success animation
            const btn = document.getElementById('addEmployeeBtn');
            btn.textContent = '‚úÖ Added!';
            btn.className = btn.className.replace('bg-green-600', 'bg-green-500');
            setTimeout(() => {
                btn.textContent = '‚ûï Add Employee';
                btn.className = btn.className.replace('bg-green-500', 'bg-green-600');
            }, 1500);
        }

        function removeEmployee() {
            const removeSelect = document.getElementById('removeEmployeeSelect');
            const employeeName = removeSelect.value;
            
            if (!employeeName) return;

            if (confirm(`Are you sure you want to remove ${employeeName}? This will remove them from all shifts.`)) {
                // Remove from all shift assignments
                scheduleData.dates.forEach(dateObj => {
                    Object.keys(dateObj.shifts).forEach(shiftType => {
                        dateObj.shifts[shiftType].assigned = dateObj.shifts[shiftType].assigned.filter(
                            name => name !== employeeName
                        );
                    });
                });

                // Remove from employees list
                scheduleData.employees = scheduleData.employees.filter(emp => emp.name !== employeeName);
                
                removeSelect.value = '';
                updateUI();
                saveData();
                
                // Success feedback
                const btn = document.getElementById('removeEmployeeBtn');
                btn.textContent = 'üóëÔ∏è Removed!';
                btn.disabled = true;
                setTimeout(() => {
                    btn.textContent = 'üóëÔ∏è Remove Employee';
                }, 1500);
            }
        }

        // Shift Management
        function setRequirement() {
            if (!selectedDate || !selectedShift) return;

            const requiredPeople = parseInt(document.getElementById('requiredPeople').value) || 0;
            const dateObj = scheduleData.dates.find(d => d.date === selectedDate);
            
            if (dateObj) {
                dateObj.shifts[selectedShift].required = requiredPeople;
                updateUI();
                saveData();
                
                // Show suggestions if needed
                if (requiredPeople > 0) {
                    setTimeout(showSuggestions, 300);
                }
            }
        }

        function assignEmployee() {
            const employeeSelect = document.getElementById('employeeSelect');
            const employeeName = employeeSelect.value;
            
            if (!selectedDate || !selectedShift || !employeeName) return;

            const dateObj = scheduleData.dates.find(d => d.date === selectedDate);
            if (!dateObj) return;

            if (dateObj.shifts[selectedShift].assigned.includes(employeeName)) return;

            dateObj.shifts[selectedShift].assigned.push(employeeName);
            
            // Update employee stats
            const employee = scheduleData.employees.find(emp => emp.name === employeeName);
            if (employee) {
                employee.totalShifts++;
                employee.shiftBreakdown[selectedShift]++;
            }

            employeeSelect.value = '';
            updateUI();
            saveData();
        }

        function showSuggestions() {
            if (!selectedDate || !selectedShift) return;

            const dateObj = scheduleData.dates.find(d => d.date === selectedDate);
            const requiredPeople = dateObj.shifts[selectedShift].required;
            const currentAssigned = dateObj.shifts[selectedShift].assigned.length;
            const needed = requiredPeople - currentAssigned;

            if (needed <= 0) return;

            const suggestions = getSuggestedEmployees(selectedDate, selectedShift, needed);
            if (suggestions.length === 0) return;

            const panel = document.getElementById('suggestionsPanel');
            const list = document.getElementById('suggestedEmployeesList');
            
            list.innerHTML = '';
            suggestions.forEach((emp, index) => {
                const div = document.createElement('div');
                div.className = 'bg-white p-3 rounded-lg border-l-4 border-cyan-500 shadow-sm';
                div.innerHTML = `
                    <span class="font-medium">${index + 1}. ${emp.name}</span>
                    <span class="text-gray-600 ml-2">(Group ${emp.group}, ${emp.totalShifts} total shifts)</span>
                `;
                list.appendChild(div);
            });

            panel.classList.remove('hidden');
            window.currentSuggestions = suggestions;
        }

        function autoAssignSuggestions() {
            if (!window.currentSuggestions || !selectedDate || !selectedShift) return;

            const dateObj = scheduleData.dates.find(d => d.date === selectedDate);
            if (!dateObj) return;

            window.currentSuggestions.forEach(emp => {
                if (!dateObj.shifts[selectedShift].assigned.includes(emp.name)) {
                    dateObj.shifts[selectedShift].assigned.push(emp.name);
                    emp.totalShifts++;
                    emp.shiftBreakdown[selectedShift]++;
                }
            });

            document.getElementById('suggestionsPanel').classList.add('hidden');
            window.currentSuggestions = null;
            updateUI();
            saveData();
        }

        function removeFromShift(date, shiftType, employeeName) {
            const dateObj = scheduleData.dates.find(d => d.date === date);
            if (!dateObj) return;

            dateObj.shifts[shiftType].assigned = dateObj.shifts[shiftType].assigned.filter(
                name => name !== employeeName
            );

            const employee = scheduleData.employees.find(emp => emp.name === employeeName);
            if (employee) {
                employee.totalShifts = Math.max(0, employee.totalShifts - 1);
                employee.shiftBreakdown[shiftType] = Math.max(0, employee.shiftBreakdown[shiftType] - 1);
            }

            updateUI();
            saveData();
        }

        // UI Updates
        function updateScheduleOverview() {
            const container = document.getElementById('scheduleOverview');
            container.innerHTML = '';

            scheduleData.dates.forEach(dateObj => {
                const dateDiv = document.createElement('div');
                dateDiv.className = 'border rounded-xl p-4 bg-gray-50';
                
                let shiftsHTML = '';
                Object.keys(dateObj.shifts).forEach(shiftType => {
                    const shift = dateObj.shifts[shiftType];
                    const shiftInfo = scheduleData.shifts[shiftType];
                    const status = shift.required === 0 ? 'inactive' :

shift.assigned.length >= shift.required ? 'complete' : 'understaffed';
                    
                    const statusColor = status === 'inactive' ? 'bg-gray-200' : 
                                      status === 'complete' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
                    
                    shiftsHTML += `
                        <div class="shift-${shiftType} text-white p-3 rounded-lg mb-2">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium">${shiftInfo.icon} ${shiftInfo.name}</span>
                                <span class="text-sm opacity-90">${shiftInfo.time}</span>
                            </div>
                            <div class="text-sm opacity-90 mb-2">
                                Required: ${shift.required} | Assigned: ${shift.assigned.length}
                            </div>
                            ${shift.assigned.length > 0 ? `
                                <div class="flex flex-wrap gap-1">
                                    ${shift.assigned.map(name => `
                                        <span class="bg-white bg-opacity-20 px-2 py-1 rounded text-xs flex items-center gap-1">
                                            ${name}
                                            <button onclick="removeFromShift('${dateObj.date}', '${shiftType}', '${name}')" 
                                                    class="hover:bg-red-500 rounded-full w-4 h-4 flex items-center justify-center text-xs">
                                                √ó
                                            </button>
                                        </span>
                                    `).join('')}
                                </div>
                            ` : '<div class="text-sm opacity-75">No assignments</div>'}
                        </div>
                    `;
                });

                dateDiv.innerHTML = `
                    <h3 class="font-bold text-lg mb-3 text-gray-800">${dateObj.date}</h3>
                    ${shiftsHTML}
                `;
                
                container.appendChild(dateDiv);
            });
        }

        function updateEmployeeStats() {
            const container = document.getElementById('employeeStats');
            container.innerHTML = '';

            if (scheduleData.employees.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No employees added yet</p>';
                return;
            }

            // Sort employees by total shifts for better visualization
            const sortedEmployees = [...scheduleData.employees].sort((a, b) => b.totalShifts - a.totalShifts);

            sortedEmployees.forEach(emp => {
                const maxShifts = Math.max(...scheduleData.employees.map(e => e.totalShifts)) || 1;
                const progressPercentage = (emp.totalShifts / maxShifts) * 100;

                const div = document.createElement('div');
                div.className = 'employee-card bg-gradient-to-r from-gray-50 to-gray-100 p-4 rounded-lg border shadow-sm';
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-800">${emp.name}</h4>
                            <span class="text-sm text-gray-600">Group ${emp.group}</span>
                        </div>
                        <div class="text-right">
                            <div class="text-2xl font-bold text-blue-600">${emp.totalShifts}</div>
                            <div class="text-xs text-gray-500">Total Shifts</div>
                        </div>
                    </div>
                    
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full transition-all duration-500" 
                             style="width: ${progressPercentage}%"></div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-2 text-sm">
                        <div class="text-center p-2 bg-blue-900 text-white rounded">
                            <div class="font-semibold">${emp.shiftBreakdown.night}</div>
                            <div class="text-xs opacity-90">Night</div>
                        </div>
                        <div class="text-center p-2 bg-orange-600 text-white rounded">
                            <div class="font-semibold">${emp.shiftBreakdown.morning}</div>
                            <div class="text-xs opacity-90">Morning</div>
                        </div>
                        <div class="text-center p-2 bg-green-600 text-white rounded">
                            <div class="font-semibold">${emp.shiftBreakdown.late}</div>
                            <div class="text-xs opacity-90">Late</div>
                        </div>
                    </div>
                `;
                container.appendChild(div);
            });
        }

        function updateSummaryDashboard() {
            const totalEmployees = scheduleData.employees.length;
            const totalAssignments = scheduleData.employees.reduce((sum, emp) => sum + emp.totalShifts, 0);
            const avgShiftsPerPerson = totalEmployees > 0 ? (totalAssignments / totalEmployees).toFixed(1) : 0;
            
            let understaffedCount = 0;
            scheduleData.dates.forEach(dateObj => {
                Object.keys(dateObj.shifts).forEach(shiftType => {
                    const shift = dateObj.shifts[shiftType];
                    if (shift.required > 0 && shift.assigned.length < shift.required) {
                        understaffedCount++;
                    }
                });
            });

            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('totalAssignments').textContent = totalAssignments;
            document.getElementById('avgShiftsPerPerson').textContent = avgShiftsPerPerson;
            document.getElementById('understaffedShifts').textContent = understaffedCount;
        }

        function updateUI() {
            populateDateSelect();
            populateEmployeeSelects();
            updateScheduleOverview();
            updateEmployeeStats();
            updateSummaryDashboard();
        }

        // Event Listeners
        function setupEventListeners() {
            // Date and shift selection
            document.getElementById('dateSelect').addEventListener('change', function() {
                selectedDate = this.value;
                selectedShift = '';
                document.getElementById('shiftTypeSelect').value = '';
                document.getElementById('requiredPeople').value = '0';
                document.getElementById('setRequirementBtn').disabled = true;
                document.getElementById('assignEmployeeBtn').disabled = true;
                document.getElementById('suggestionsPanel').classList.add('hidden');
                updateUI();
            });

            document.getElementById('shiftTypeSelect').addEventListener('change', function() {
                selectedShift = this.value;
                
                if (selectedDate && selectedShift) {
                    const dateObj = scheduleData.dates.find(d => d.date === selectedDate);
                    if (dateObj) {
                        document.getElementById('requiredPeople').value = dateObj.shifts[selectedShift].required;
                    }
                    document.getElementById('setRequirementBtn').disabled = false;
                    document.getElementById('assignEmployeeBtn').disabled = false;
                } else {
                    document.getElementById('setRequirementBtn').disabled = true;
                    document.getElementById('assignEmployeeBtn').disabled = false;
                }
                
                document.getElementById('suggestionsPanel').classList.add('hidden');
                updateUI();
            });

            // Employee management
            document.getElementById('addEmployeeBtn').addEventListener('click', addEmployee);
            document.getElementById('removeEmployeeBtn').addEventListener('click', removeEmployee);
            document.getElementById('removeEmployeeSelect').addEventListener('change', function() {
                document.getElementById('removeEmployeeBtn').disabled = !this.value;
            });

            // Shift management
            document.getElementById('setRequirementBtn').addEventListener('click', setRequirement);
            document.getElementById('assignEmployeeBtn').addEventListener('click', assignEmployee);

            // Suggestions
            document.getElementById('getSuggestionsBtn').addEventListener('click', showSuggestions);
            document.getElementById('autoAssignBtn').addEventListener('click', autoAssignSuggestions);
            document.getElementById('hideSuggestionsBtn').addEventListener('click', function() {
                document.getElementById('suggestionsPanel').classList.add('hidden');
            });

            // Enter key support
            document.getElementById('newEmployeeName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') addEmployee();
            });
        }

        // Reset function
        function resetAllData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                // Clear cookie
                document.cookie = 'scheduleData=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
                
                // Reinitialize
                initializeDates();
                initializeEmployees();
                
                // Reset UI state
                selectedDate = '';
                selectedShift = '';
                document.getElementById('dateSelect').value = '';
                document.getElementById('shiftTypeSelect').value = '';
                document.getElementById('requiredPeople').value = '0';
                document.getElementById('suggestionsPanel').classList.add('hidden');
                
                updateUI();
                saveData();
                
                // Show success message
                alert('All data has been reset successfully!');
            }
        }

        // Initialize Application
        function initializeApp() {
            // Try to load saved data, otherwise use defaults
            if (!loadData()) {
                initializeDates();
                initializeEmployees();
                saveData();
            }
            
            setupEventListeners();
            updateUI();
            
            console.log('Multi-Shift Scheduling System initialized successfully!');
        }

        // Start the application when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>